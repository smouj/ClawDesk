<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="clawdesk-api-token" content="__CLAWDESK_TOKEN__" />
    <title>ClawDesk OS · Mission Control v2.0.0</title>
    <link rel="icon" href="assets/brand/logo-brain.svg" />
    <link rel="stylesheet" href="styles/tokens.css" />
    <link rel="stylesheet" href="styles/components.css" />
    <link rel="stylesheet" href="styles/layout.css" />
  </head>
  <body>
    <div class="window">
      <header class="titlebar">
        <div class="brand">
          <img src="assets/brand/logo-brain.svg" alt="ClawDesk logo" />
          <div>
            <h1>ClawDesk OS</h1>
            <small>Mission Control · Security-first · Loopback-only</small>
          </div>
        </div>
        <div class="status">
          <div class="status-metrics">
            <div class="metric-chip">
              <span>Host</span>
              <strong id="lcd-status">127.0.0.1:--</strong>
            </div>
            <div class="metric-chip muted">
              <span>Latencia</span>
              <strong id="lcd-latency">-- ms</strong>
            </div>
            <div class="metric-chip muted">
              <span>Uptime</span>
              <strong id="lcd-uptime">--</strong>
            </div>
          </div>
          <div class="status-controls">
            <div class="vu" id="vu-activity" aria-hidden="true">
              <span></span><span></span><span></span><span></span><span></span>
            </div>
            <select id="profile-select" aria-label="Perfil activo"></select>
          </div>
        </div>
      </header>

      <nav class="tabstrip" role="tablist">
        <button
          class="active"
          data-page="dashboard"
          role="tab"
          aria-selected="true"
          aria-controls="page-dashboard"
          tabindex="0"
        >
          Inicio
        </button>
        <button
          data-page="agents"
          role="tab"
          aria-selected="false"
          aria-controls="page-agents"
          tabindex="-1"
        >
          Agentes
        </button>
        <button
          data-page="skills"
          role="tab"
          aria-selected="false"
          aria-controls="page-skills"
          tabindex="-1"
        >
          Skills
        </button>
        <button
          data-page="config"
          role="tab"
          aria-selected="false"
          aria-controls="page-config"
          tabindex="-1"
        >
          Configuración
        </button>
        <button
          data-page="security"
          role="tab"
          aria-selected="false"
          aria-controls="page-security"
          tabindex="-1"
        >
          Seguridad
        </button>
        <button
          data-page="logs"
          role="tab"
          aria-selected="false"
          aria-controls="page-logs"
          tabindex="-1"
        >
          Logs
        </button>
        <button
          data-page="profiles"
          role="tab"
          aria-selected="false"
          aria-controls="page-profiles"
          tabindex="-1"
        >
          Perfiles
        </button>
        <button
          data-page="usage"
          role="tab"
          aria-selected="false"
          aria-controls="page-usage"
          tabindex="-1"
        >
          Uso
        </button>
        <button
          data-page="timeline"
          role="tab"
          aria-selected="false"
          aria-controls="page-timeline"
          tabindex="-1"
        >
          Línea de tiempo
        </button>
        <button
          data-page="macros"
          role="tab"
          aria-selected="false"
          aria-controls="page-macros"
          tabindex="-1"
        >
          Macros
        </button>
      </nav>

      <section class="page active" id="page-dashboard">
        <div class="toolbar">
          <div class="inline">
            <span class="badge" id="version-badge">v2.0.0</span>
            <span class="badge" id="gateway-state">offline</span>
          </div>
          <div class="inline">
            <button
              class="btn"
              id="refresh-dashboard"
              aria-label="Sincronizar estado del dashboard"
            >
              Sincronizar
            </button>
            <button class="btn secondary" id="open-control-ui" aria-label="Abrir panel del gateway">
              Abrir Control UI
            </button>
          </div>
        </div>
        <div class="stats-grid">
          <article class="card">
            <div class="section-header">
              <h3>Mission Control</h3>
              <span class="badge ok" id="gateway-allow">policy</span>
            </div>
            <div class="card-kpi">
              <span class="status-pill" id="gateway-summary">Sin datos</span>
              <div class="kpi-stack">
                <div>
                  <span class="kpi-label">Gateway</span>
                  <strong class="kpi-value" id="gateway-version">--</strong>
                </div>
                <div>
                  <span class="kpi-label">Token</span>
                  <strong class="kpi-value" id="gateway-token">--</strong>
                </div>
              </div>
            </div>
            <div class="inline">
              <span class="lcd" id="gateway-latency">latencia --</span>
              <span class="lcd" id="gateway-bind">bind --</span>
              <span class="lcd" id="gateway-activity">última actividad --</span>
            </div>
          </article>
          <article class="card">
            <div class="section-header">
              <h3>Acciones rápidas</h3>
              <span class="badge ok">loopback</span>
            </div>
            <p class="muted">Acciones seguras sobre el gateway. Se aplican políticas de allow-actions.</p>
            <div class="inline wrap">
              <button class="btn" id="gateway-start" aria-label="Iniciar gateway">Iniciar</button>
              <button class="btn secondary" id="gateway-stop" aria-label="Detener gateway">
                Detener
              </button>
              <button class="btn secondary" id="gateway-restart" aria-label="Reiniciar gateway">
                Reiniciar
              </button>
              <button class="btn ghost" id="open-logs" aria-label="Abrir logs">
                Ver logs
              </button>
            </div>
          </article>
          <article class="card">
            <div class="section-header">
              <h3>Usage hoy</h3>
              <span class="badge" id="usage-state">n/a</span>
            </div>
            <div class="kpi-split">
              <div>
                <span class="kpi-label">Tokens</span>
                <strong class="kpi-value" id="usage-tokens">tokens --</strong>
              </div>
              <div>
                <span class="kpi-label">Cost</span>
                <strong class="kpi-value" id="usage-cost">cost --</strong>
              </div>
            </div>
            <p class="muted" id="usage-note">Sin datos recientes.</p>
          </article>
          <article class="card">
            <div class="section-header">
              <h3>Seguridad</h3>
              <span class="badge">0 total</span>
            </div>
            <p class="muted">
              Acceso remoto seguro solo vía túneles cifrados (Tailscale/WireGuard/SSH).
            </p>
            <div class="inline">
              <button
                class="btn secondary"
                id="tailscale-guide"
                aria-label="Abrir guía de Tailscale"
              >
                Guía Tailscale
              </button>
              <button class="btn secondary" id="ssh-guide" aria-label="Abrir guía de SSH Tunneling">
                Guía SSH
              </button>
            </div>
          </article>
        </div>
        <div class="dashboard-grid">
          <div class="dashboard-panel">
            <div class="section-header">
              <h3>Agentes activos</h3>
              <button
                class="btn secondary"
                id="view-agents"
                aria-label="Ver agentes en el Control UI"
              >
                Abrir Control UI
              </button>
            </div>
            <div class="agent-grid">
              <div class="empty-state">
                <strong>Sin agentes conectados</strong>
                <span class="muted">Activa un agente o revisa el estado del gateway.</span>
              </div>
            </div>
          </div>
          <div class="dashboard-panel">
            <div class="section-header">
              <h3>Eventos recientes</h3>
              <button class="btn ghost" id="view-events" aria-label="Ver todos los eventos">
                Ver todo
              </button>
            </div>
            <div class="card" id="recent-events"></div>
          </div>
        </div>
      </section>

      <section class="page" id="page-agents">
        <div class="toolbar">
          <div>
            <h2>Agentes & Bots</h2>
            <p class="muted">Gestiona agentes de OpenClaw con claridad y seguridad.</p>
          </div>
          <button class="btn" id="agents-refresh" aria-label="Actualizar agentes">Actualizar</button>
        </div>
        <div class="grid-2">
          <div class="card">
            <div class="section-header">
              <h3>Agentes disponibles</h3>
              <span class="badge" id="agents-source">origen</span>
            </div>
            <div id="agents-list"></div>
            <p class="muted" id="agents-empty">Sin agentes registrados.</p>
          </div>
          <div class="card">
            <h3>Crear agente</h3>
            <form id="agent-form" class="stack">
              <label>
                Nombre
                <input name="name" type="text" placeholder="main" required />
              </label>
              <label>
                Proveedor
                <input name="provider" type="text" placeholder="openai" />
              </label>
              <label>
                Modelo
                <input name="model" type="text" placeholder="gpt-4o-mini" />
              </label>
              <label>
                Ruta de almacenamiento
                <input name="storage_path" type="text" placeholder="~/.openclaw/agents/main" />
              </label>
              <label>
                Metadata (JSON opcional)
                <textarea name="metadata" rows="4" placeholder="{\"region\":\"eu\"}"></textarea>
              </label>
              <button class="btn" type="submit">Crear agente</button>
            </form>
            <div class="divider"></div>
            <h3>Importar agente</h3>
            <textarea id="agent-import" rows="4" placeholder='{\"name\":\"demo\",\"provider\":\"local\"}'></textarea>
            <button class="btn secondary" id="agent-import-btn">Importar</button>
          </div>
        </div>
      </section>

      <section class="page" id="page-skills">
        <div class="toolbar">
          <div>
            <h2>Centro de Skills</h2>
            <p class="muted">Activa skills, valida requisitos y refresca estado.</p>
          </div>
          <div class="inline">
            <button class="btn secondary" id="skills-refresh">Re-escanear</button>
          </div>
        </div>
        <div class="grid-2">
          <div class="card">
            <div class="section-header">
              <h3>Skills detectadas</h3>
              <span class="badge" id="skills-source">origen</span>
            </div>
            <div id="skills-list"></div>
            <p class="muted" id="skills-empty">Sin skills registradas.</p>
          </div>
          <div class="card">
            <h3>Requisitos faltantes</h3>
            <p class="muted">No se instalan automáticamente. Copia y ejecuta manualmente.</p>
            <div class="terminal" id="skills-requirements">Sin requisitos pendientes.</div>
            <button class="btn ghost" id="skills-copy">Copiar comandos</button>
          </div>
        </div>
      </section>

      <section class="page" id="page-config">
        <div class="toolbar">
          <div>
            <h2>Centro de Configuración</h2>
            <p class="muted">Configura ClawDesk y OpenClaw con validación y backups.</p>
          </div>
          <button class="btn secondary" id="config-refresh">Recargar</button>
        </div>
        <div class="grid-2">
          <div class="card">
            <div class="section-header">
              <h3>ClawDesk config.json</h3>
              <span class="badge" id="config-perms">600</span>
            </div>
            <textarea id="clawdesk-config" rows="18" spellcheck="false"></textarea>
            <div class="inline wrap">
              <button class="btn" id="clawdesk-save">Guardar</button>
              <button class="btn secondary" id="clawdesk-validate">Validar</button>
              <button class="btn ghost" id="clawdesk-format">Formatear</button>
            </div>
            <div class="inline">
              <select id="clawdesk-backups"></select>
              <button class="btn danger" id="clawdesk-restore">Restaurar backup</button>
            </div>
          </div>
          <div class="card">
            <div class="section-header">
              <h3>OpenClaw openclaw.json</h3>
              <span class="badge" id="openclaw-perms">n/a</span>
            </div>
            <textarea id="openclaw-config" rows="18" spellcheck="false"></textarea>
            <div class="inline wrap">
              <button class="btn" id="openclaw-save">Guardar</button>
              <button class="btn secondary" id="openclaw-validate">Validar</button>
              <button class="btn ghost" id="openclaw-format">Formatear</button>
            </div>
            <div class="inline">
              <select id="openclaw-backups"></select>
              <button class="btn danger" id="openclaw-restore">Restaurar backup</button>
            </div>
          </div>
        </div>
      </section>

      <section class="page" id="page-security">
        <div class="toolbar">
          <div>
            <h2>Centro de Seguridad</h2>
            <p class="muted">Loopback-only por defecto. Acceso remoto solo con túneles cifrados.</p>
          </div>
        </div>
        <div class="grid-2">
          <div class="card">
            <h3>Buenas prácticas</h3>
            <ul class="list">
              <li>✅ Loopback-only (127.0.0.1 / ::1).</li>
              <li>⚠️ Acceso remoto: usa SSH/Tailscale/WireGuard.</li>
              <li>✅ Secretos redactados en UI y logs.</li>
            </ul>
            <div class="inline">
              <button class="btn secondary" id="run-doctor">OpenClaw doctor</button>
              <button class="btn secondary" id="security-audit">Audit de seguridad</button>
              <button class="btn danger" id="security-audit-deep">Audit profundo</button>
            </div>
          </div>
          <div class="card">
            <h3>Resultado de auditoría</h3>
            <div class="terminal" id="security-output">Ejecuta un audit para ver resultados.</div>
          </div>
        </div>
      </section>

      <section class="page" id="page-profiles">
        <div class="toolbar">
          <div>
            <h2>Perfiles multi-gateway</h2>
            <p class="muted">Gestiona conexiones locales y remotas con seguridad primero.</p>
          </div>
          <button class="btn" id="new-profile" aria-label="Crear nuevo perfil">Nuevo perfil</button>
        </div>
        <div class="grid-2" id="profiles-list"></div>
        <p class="muted" id="profiles-empty">No hay perfiles registrados.</p>
      </section>

      <section class="page" id="page-macros">
        <div class="toolbar">
          <h2>Automatización y macros</h2>
        </div>
        <div class="grid-2">
          <div class="card">
            <h3>Macros disponibles</h3>
            <div id="macro-list"></div>
          </div>
          <div class="card">
            <h3>Output</h3>
            <div class="terminal" id="macro-output">Esperando ejecución...</div>
          </div>
        </div>
      </section>

      <section class="page" id="page-usage">
        <div class="toolbar">
          <div>
            <h2>Centro de uso</h2>
            <p class="muted">Tokens y costos por proveedor/modelo.</p>
          </div>
          <div class="inline">
            <select id="usage-range">
              <option value="24h">Últimas 24h</option>
              <option value="7d">Últimos 7 días</option>
            </select>
            <button class="btn secondary" id="export-json" aria-label="Exportar uso en JSON">
              Exportar JSON
            </button>
            <button class="btn secondary" id="export-csv" aria-label="Exportar uso en CSV">
              Exportar CSV
            </button>
          </div>
        </div>
        <div class="usage-grid">
          <article class="card usage-card">
            <div class="section-header">
            <h3>Total tokens</h3>
              <span class="badge ok">24h</span>
            </div>
            <strong class="kpi-large" id="usage-total-tokens">tokens --</strong>
            <p class="muted" id="usage-timestamp">--</p>
          </article>
          <article class="card usage-card">
            <div class="section-header">
            <h3>Coste total</h3>
              <span class="badge">Providers</span>
            </div>
            <strong class="kpi-large" id="usage-total-cost">cost --</strong>
            <p class="muted">Coste agregado en el periodo.</p>
          </article>
          <article class="card usage-card">
            <div class="section-header">
            <h3>API calls</h3>
              <span class="badge warn">n/a</span>
            </div>
            <strong class="kpi-large muted">--</strong>
            <p class="muted">Sin datos de requests.</p>
          </article>
          <article class="card usage-card">
            <div class="section-header">
            <h3>Latencia media</h3>
              <span class="badge warn">n/a</span>
            </div>
            <strong class="kpi-large muted">--</strong>
            <p class="muted">Sin telemetría de latencia.</p>
          </article>
          <article class="card">
            <h3>Por proveedor</h3>
            <table class="table" id="usage-providers"></table>
          </article>
          <article class="card">
            <h3>Por modelo</h3>
            <table class="table" id="usage-models"></table>
          </article>
          <article class="card">
            <h3>Por herramienta</h3>
            <table class="table" id="usage-tools"></table>
          </article>
        </div>
      </section>

      <section class="page" id="page-timeline">
        <div class="toolbar">
          <h2>Línea de tiempo</h2>
          <button class="btn" id="refresh-events" aria-label="Actualizar eventos">
            Actualizar
          </button>
        </div>
        <div class="card">
          <div id="timeline-list"></div>
        </div>
      </section>

      <section class="page" id="page-logs">
        <div class="toolbar">
          <div>
            <h2>Logs en vivo</h2>
            <p class="muted">Stream en tiempo real desde gateway y agentes.</p>
          </div>
          <div class="inline wrap">
            <input
              type="search"
              id="log-filter"
              placeholder="Filtrar por palabra clave..."
              aria-label="Filtrar logs"
            />
            <button class="btn secondary" id="toggle-scroll" aria-label="Pausar o reanudar scroll">
              Pausar
            </button>
            <button class="btn secondary" id="download-logs" aria-label="Descargar logs">
              Descargar
            </button>
            <button class="btn ghost" id="clear-logs" aria-label="Limpiar vista de logs">
              Limpiar vista
            </button>
          </div>
        </div>
        <div class="grid-2">
          <div class="card">
            <h3>Diagnóstico rápido</h3>
            <div id="diagnostics-summary"></div>
          </div>
          <div class="card">
            <h3>Health checks</h3>
            <div id="health-checks"></div>
          </div>
        </div>
        <div class="terminal" id="log-stream"></div>
      </section>

      <section class="page" id="page-settings">
        <div class="toolbar">
          <h2>Ajustes</h2>
        </div>
        <div class="grid-2">
          <article class="card">
            <h3>Refresh rate</h3>
            <div class="inline">
              <div class="knob" aria-hidden="true"></div>
              <input type="range" id="refresh-rate" min="800" max="8000" step="200" value="1500" />
              <span class="lcd" id="refresh-rate-label">1500ms</span>
            </div>
          </article>
          <article class="card">
            <h3>Perfiles remotos</h3>
            <p class="muted">Requiere opt-in explícito en config.json + confirmación en UI.</p>
            <span class="badge" id="remote-status">disabled</span>
          </article>
        </div>
      </section>

      <footer>ClawDesk v2.0.0 · Dashboard loopback-only · Security-first.</footer>
    </div>

    <div class="modal" id="guide-modal" aria-hidden="true">
      <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="guide-title">
        <div class="section-header">
          <h3 id="guide-title">Guía</h3>
          <button class="btn secondary" id="guide-close">Cerrar</button>
        </div>
        <div class="modal-body" id="guide-body"></div>
      </div>
    </div>

    <div class="modal" id="profile-modal" aria-hidden="true">
      <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="profile-title">
        <div class="section-header">
          <h3 id="profile-title">Nuevo perfil</h3>
          <button class="btn secondary" id="profile-close">Cerrar</button>
        </div>
        <form id="profile-form" class="form">
          <label>
            Nombre
            <input type="text" name="name" placeholder="edge-eu" required />
          </label>
          <label>
            Bind
            <input type="text" name="bind" placeholder="127.0.0.1" />
          </label>
          <label>
            Puerto
            <input type="number" name="port" min="1024" max="65535" value="18789" required />
          </label>
          <label>
            Token (opcional)
            <input
              type="password"
              name="token"
              placeholder="usa variables de entorno"
              autocomplete="new-password"
            />
          </label>
          <div class="inline">
            <button class="btn" type="submit">Guardar</button>
            <span class="muted">Remote profiles requieren opt-in en config.json.</span>
          </div>
        </form>
      </div>
    </div>

    <div class="toast" id="toast" role="status" aria-live="polite"></div>
    <script type="module" src="js/app.js"></script>
  </body>
</html>
