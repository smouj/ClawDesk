<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="clawdesk-api-token" content="__CLAWDESK_TOKEN__" />
    <title>ClawDesk OS · Retro-OS 2000 v2.0.0</title>
    <link rel="icon" href="assets/brand/logo-brain.svg" />
    <link rel="stylesheet" href="styles/tokens.css" />
    <link rel="stylesheet" href="styles/components.css" />
    <link rel="stylesheet" href="styles/layout.css" />
  </head>
  <body>
    <div class="window">
      <header class="titlebar">
        <div class="brand">
          <img src="assets/brand/logo-brain.svg" alt="ClawDesk logo" />
          <div>
            <h1>ClawDesk OS</h1>
            <small>Retro-OS 2000 · Security-first Control Plane</small>
          </div>
        </div>
        <div class="status">
          <div class="status-metrics">
            <div class="metric-chip">
              <span>Host</span>
              <strong id="lcd-status">127.0.0.1:--</strong>
            </div>
            <div class="metric-chip muted">
              <span>Latency</span>
              <strong>-- ms</strong>
            </div>
            <div class="metric-chip muted">
              <span>Uptime</span>
              <strong>--</strong>
            </div>
          </div>
          <div class="status-controls">
            <div class="vu" id="vu-activity" aria-hidden="true">
              <span></span><span></span><span></span><span></span><span></span>
            </div>
            <select id="profile-select" aria-label="Perfil activo"></select>
          </div>
        </div>
      </header>

      <nav class="tabstrip" role="tablist">
        <button
          class="active"
          data-page="dashboard"
          role="tab"
          aria-selected="true"
          aria-controls="page-dashboard"
          tabindex="0"
        >
          Dashboard
        </button>
        <button
          data-page="profiles"
          role="tab"
          aria-selected="false"
          aria-controls="page-profiles"
          tabindex="-1"
        >
          Profiles
        </button>
        <button
          data-page="macros"
          role="tab"
          aria-selected="false"
          aria-controls="page-macros"
          tabindex="-1"
        >
          Macros
        </button>
        <button
          data-page="usage"
          role="tab"
          aria-selected="false"
          aria-controls="page-usage"
          tabindex="-1"
        >
          Usage Center
        </button>
        <button
          data-page="timeline"
          role="tab"
          aria-selected="false"
          aria-controls="page-timeline"
          tabindex="-1"
        >
          Timeline
        </button>
        <button
          data-page="logs"
          role="tab"
          aria-selected="false"
          aria-controls="page-logs"
          tabindex="-1"
        >
          Logs
        </button>
        <button
          data-page="settings"
          role="tab"
          aria-selected="false"
          aria-controls="page-settings"
          tabindex="-1"
        >
          Settings
        </button>
      </nav>

      <section class="page active" id="page-dashboard">
        <div class="toolbar">
          <div class="inline">
            <span class="badge" id="version-badge">v2.0.0</span>
            <span class="badge" id="gateway-state">offline</span>
          </div>
          <div class="inline">
            <button
              class="btn"
              id="refresh-dashboard"
              aria-label="Sincronizar estado del dashboard"
            >
              Sync
            </button>
            <button class="btn secondary" id="open-control-ui" aria-label="Abrir panel del gateway">
              Open Control UI
            </button>
          </div>
        </div>
        <div class="stats-grid">
          <article class="card">
            <div class="section-header">
              <h3>Gateway</h3>
              <span class="badge ok" id="gateway-allow">allow-actions</span>
            </div>
            <div class="card-kpi">
              <span class="status-pill" id="gateway-summary">Sin datos</span>
              <div class="kpi-stack">
                <div>
                  <span class="kpi-label">Version</span>
                  <strong class="kpi-value" id="gateway-version">--</strong>
                </div>
                <div>
                  <span class="kpi-label">Connections</span>
                  <strong class="kpi-value muted">--</strong>
                </div>
              </div>
            </div>
            <div class="inline">
              <span class="lcd" id="gateway-latency">latency --</span>
              <span class="lcd" id="gateway-bind">bind --</span>
            </div>
          </article>
          <article class="card">
            <div class="section-header">
              <h3>Security</h3>
              <span class="badge ok">Loopback</span>
            </div>
            <p class="muted">Acceso remoto solo vía túneles cifrados (Tailscale/WireGuard/SSH).</p>
            <div class="inline">
              <button
                class="btn secondary"
                id="tailscale-guide"
                aria-label="Abrir guía de Tailscale"
              >
                Guía Tailscale
              </button>
              <button class="btn secondary" id="ssh-guide" aria-label="Abrir guía de SSH Tunneling">
                Guía SSH
              </button>
            </div>
          </article>
          <article class="card">
            <div class="section-header">
              <h3>Usage Today</h3>
              <span class="badge" id="usage-state">n/a</span>
            </div>
            <div class="kpi-split">
              <div>
                <span class="kpi-label">Tokens</span>
                <strong class="kpi-value" id="usage-tokens">tokens --</strong>
              </div>
              <div>
                <span class="kpi-label">Cost</span>
                <strong class="kpi-value" id="usage-cost">cost --</strong>
              </div>
            </div>
            <p class="muted" id="usage-note">Sin datos recientes.</p>
          </article>
          <article class="card">
            <div class="section-header">
              <h3>Agents</h3>
              <span class="badge">0 total</span>
            </div>
            <div class="agent-summary">
              <div>
                <span class="dot dot-ok"></span>
                <span class="muted">Running</span>
                <strong>0</strong>
              </div>
              <div>
                <span class="dot dot-warn"></span>
                <span class="muted">Idle</span>
                <strong>0</strong>
              </div>
              <div>
                <span class="dot dot-muted"></span>
                <span class="muted">Stopped</span>
                <strong>0</strong>
              </div>
            </div>
            <p class="muted">Sin telemetría de agentes.</p>
          </article>
        </div>
        <div class="dashboard-grid">
          <div class="dashboard-panel">
            <div class="section-header">
              <h3>Active Agents</h3>
              <button
                class="btn secondary"
                id="view-agents"
                aria-label="Ver agentes en el Control UI"
              >
                Open Control UI
              </button>
            </div>
            <div class="agent-grid">
              <div class="empty-state">
                <strong>Sin agentes conectados</strong>
                <span class="muted">Activa un agente o revisa el gateway.</span>
              </div>
            </div>
          </div>
          <div class="dashboard-panel">
            <div class="section-header">
              <h3>Recent Events</h3>
              <button class="btn ghost" id="view-events" aria-label="Ver todos los eventos">
                Ver todo
              </button>
            </div>
            <div class="card" id="recent-events"></div>
          </div>
        </div>
      </section>

      <section class="page" id="page-profiles">
        <div class="toolbar">
          <div>
            <h2>Multi-Gateway Profiles</h2>
            <p class="muted">Gestiona conexiones locales y remotas con seguridad primero.</p>
          </div>
          <button class="btn" id="new-profile" aria-label="Crear nuevo perfil">Nuevo perfil</button>
        </div>
        <div class="grid-2" id="profiles-list"></div>
        <p class="muted" id="profiles-empty">No hay perfiles registrados.</p>
      </section>

      <section class="page" id="page-macros">
        <div class="toolbar">
          <h2>Automation / Macros</h2>
        </div>
        <div class="grid-2">
          <div class="card">
            <h3>Macros disponibles</h3>
            <div id="macro-list"></div>
          </div>
          <div class="card">
            <h3>Output</h3>
            <div class="terminal" id="macro-output">Esperando ejecución...</div>
          </div>
        </div>
      </section>

      <section class="page" id="page-usage">
        <div class="toolbar">
          <div>
            <h2>Usage Center</h2>
            <p class="muted">Token usage y costos por proveedor/modelo.</p>
          </div>
          <div class="inline">
            <select id="usage-range">
              <option value="24h">Últimas 24h</option>
              <option value="7d">Últimos 7 días</option>
            </select>
            <button class="btn secondary" id="export-json" aria-label="Exportar uso en JSON">
              Export JSON
            </button>
            <button class="btn secondary" id="export-csv" aria-label="Exportar uso en CSV">
              Export CSV
            </button>
          </div>
        </div>
        <div class="usage-grid">
          <article class="card usage-card">
            <div class="section-header">
              <h3>Total Tokens</h3>
              <span class="badge ok">24h</span>
            </div>
            <strong class="kpi-large" id="usage-total-tokens">tokens --</strong>
            <p class="muted" id="usage-timestamp">--</p>
          </article>
          <article class="card usage-card">
            <div class="section-header">
              <h3>Total Cost</h3>
              <span class="badge">Providers</span>
            </div>
            <strong class="kpi-large" id="usage-total-cost">cost --</strong>
            <p class="muted">Coste agregado en el periodo.</p>
          </article>
          <article class="card usage-card">
            <div class="section-header">
              <h3>API Calls</h3>
              <span class="badge warn">n/a</span>
            </div>
            <strong class="kpi-large muted">--</strong>
            <p class="muted">Sin datos de requests.</p>
          </article>
          <article class="card usage-card">
            <div class="section-header">
              <h3>Avg. Latency</h3>
              <span class="badge warn">n/a</span>
            </div>
            <strong class="kpi-large muted">--</strong>
            <p class="muted">Sin telemetría de latencia.</p>
          </article>
          <article class="card">
            <h3>By Provider</h3>
            <table class="table" id="usage-providers"></table>
          </article>
          <article class="card">
            <h3>By Model</h3>
            <table class="table" id="usage-models"></table>
          </article>
          <article class="card">
            <h3>By Tool</h3>
            <table class="table" id="usage-tools"></table>
          </article>
        </div>
      </section>

      <section class="page" id="page-timeline">
        <div class="toolbar">
          <h2>Event Timeline</h2>
          <button class="btn" id="refresh-events" aria-label="Actualizar eventos">Refresh</button>
        </div>
        <div class="card">
          <div id="timeline-list"></div>
        </div>
      </section>

      <section class="page" id="page-logs">
        <div class="toolbar">
          <div>
            <h2>Live Logs</h2>
            <p class="muted">Stream en tiempo real desde gateway y agentes.</p>
          </div>
          <div class="inline">
            <input
              type="search"
              id="log-filter"
              placeholder="Filtrar..."
              aria-label="Filtrar logs"
            />
            <button class="btn secondary" id="toggle-scroll" aria-label="Pausar o reanudar scroll">
              Pause
            </button>
            <button class="btn secondary" id="download-logs" aria-label="Descargar logs">
              Download
            </button>
          </div>
        </div>
        <div class="terminal" id="log-stream"></div>
      </section>

      <section class="page" id="page-settings">
        <div class="toolbar">
          <h2>Settings</h2>
        </div>
        <div class="grid-2">
          <article class="card">
            <h3>Refresh Rate</h3>
            <div class="inline">
              <div class="knob" aria-hidden="true"></div>
              <input type="range" id="refresh-rate" min="800" max="8000" step="200" value="1500" />
              <span class="lcd" id="refresh-rate-label">1500ms</span>
            </div>
          </article>
          <article class="card">
            <h3>Remote Profiles</h3>
            <p class="muted">Requiere opt-in explícito en config.json + confirmación en UI.</p>
            <span class="badge" id="remote-status">disabled</span>
          </article>
        </div>
      </section>

      <footer>ClawDesk v2.0.0 · Security-first loopback dashboard.</footer>
    </div>

    <div class="modal" id="guide-modal" aria-hidden="true">
      <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="guide-title">
        <div class="section-header">
          <h3 id="guide-title">Guía</h3>
          <button class="btn secondary" id="guide-close">Cerrar</button>
        </div>
        <div class="modal-body" id="guide-body"></div>
      </div>
    </div>

    <div class="modal" id="profile-modal" aria-hidden="true">
      <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="profile-title">
        <div class="section-header">
          <h3 id="profile-title">Nuevo perfil</h3>
          <button class="btn secondary" id="profile-close">Cerrar</button>
        </div>
        <form id="profile-form" class="form">
          <label>
            Nombre
            <input type="text" name="name" placeholder="edge-eu" required />
          </label>
          <label>
            Bind
            <input type="text" name="bind" placeholder="127.0.0.1" />
          </label>
          <label>
            Puerto
            <input type="number" name="port" min="1024" max="65535" value="18789" required />
          </label>
          <label>
            Token (opcional)
            <input
              type="password"
              name="token"
              placeholder="usa variables de entorno"
              autocomplete="new-password"
            />
          </label>
          <div class="inline">
            <button class="btn" type="submit">Guardar</button>
            <span class="muted">Remote profiles requieren opt-in en config.json.</span>
          </div>
        </form>
      </div>
    </div>

    <div class="toast" id="toast" role="status" aria-live="polite"></div>
    <script type="module" src="js/app.js"></script>
  </body>
</html>
